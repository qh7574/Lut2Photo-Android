# Lut2Photo Android应用版本

一个功能强大的Android LUT图片处理应用，支持批量处理、实时文件夹监控、GPU加速和丰富的水印功能。

![应用版本](https://img.shields.io/badge/版本-2.9.0-blue)
![Android](https://img.shields.io/badge/Android-11+-green)
![Kotlin](https://img.shields.io/badge/Kotlin-1.8.0-purple)
![Material 3](https://img.shields.io/badge/Material%203-支持-orange)


------------

## 📚 使用指南

### 快速开始

#### 1. 初始设置
1. **下载安装**应用
2. **授予权限**：
   - 存储权限（必需）
   - 通知权限（推荐）
   - 后台运行权限（文件夹监控必需）
3. **关闭电池优化**（文件夹监控必需）
4. **导入Lut文件**（可多选导入）

#### 2. 单次批量处理
1. 进入**手动处理**页面
2. 点击**选择图片**，从相册选择要处理的图片
3. 点击**选择LUT**，选择要应用的LUT文件
4. 点击**选择输出文件夹**，设置保存位置
5. 调节**处理参数**（可选）
6. 设置**水印**（可选）
7. 点击**开始处理**

#### 3. 文件夹监控设置
1. 进入**文件夹监控**页面
2. 设置**输入文件夹**（相机上传文件夹）
3. 设置**输出文件夹**（处理后保存位置）
4. 选择**LUT文件**
5. 调节**处理参数**
6. 设置**水印**（可选）
7. 开启**文件夹监控**开关

#### 4. LUT管理
1. 进入**LUT管理**页面
2. 点击**导入**（可长按多选文件导入）
3. 选择已导入的文件点击**导出**可将LUT导出
4. 内置富士胶片模拟LUT，感谢 [小红书@JC's here](https://xhslink.com/m/2J3vlHM5lH1) 制作的srgb转rec2020.flog2

## 📝todolist
### ⌛计划内
- **.vlt格式支持**
- **.vlt与.cube格式互转**
- **接入usb设备后自动处理usb设备内的图片**

### ⭕评估中
- **无实时预览的图片联机拍摄**
- **透过hdmi采集卡实现的实时预览**

### ⛔已放弃
~~- **通过usb实时监看与控制**：由于libgphoto2库在安卓上还存在部分问题，因此暂时搁置，v3分支已移除，项目回退至2.8.5（分辨率低，图传与照片同时传输会导致usb占用，无法绕过）~~

## 🚀 主要特性

### 🎯 核心功能
- **实时文件夹监控**：自动检测新文件并立即处理
- **批量图片处理**：支持同时处理多张图片
- **双引擎处理**：CPU/GPU双重处理引擎，智能回退机制
- **双Lut处理**：可选叠加第二个Lut效果
- **实时预览**：可实时预览lut和水印的应用效果
- **NDK/JNI内存管理**：绕开jvm内存限制，支持超大像素图片处理
- **多种抖动算法**：Floyd-Steinberg、随机抖动，有效减少色彩断层
- **可调节效果强度**：0-100%强度调节，支持精细控制
- **高质量输出**：50-100%质量范围，平衡文件大小与画质

### 🎨 水印系统
- **文字水印**：支持EXIF变量替换，自定义字体、颜色、位置
- **图片水印**：支持PNG/JPG水印图片，可调透明度和尺寸
- **边框功能**：四边独立边框控制，0-150%宽度可调
- **高级排版**：行间距、字间距、对齐方式等精细控制

### 🔧 技术特性
- **GPU加速处理**：OpenGL ES 3.0着色器加速，大幅提升处理速度
- **内存优化**：智能图片压缩，防止大图OOM崩溃
- **MVVM架构**：清晰的分层架构，易于维护和扩展
- **Material 3设计**：动态颜色主题，现代化UI
- **无网络权限**：完全离线工作，保护用户隐私



## 🔧 核心功能详解

### LUT处理引擎

#### GPU处理器（推荐）
**技术实现**：
- 使用OpenGL ES 3.0着色器进行并行计算
- 支持3D LUT纹理查找，精度更高
- 二维分块处理，突破GPU纹理尺寸限制
- 自动回退到CPU处理，确保兼容性

**性能优势**：
```
测试设备：骁龙8e
图片尺寸：4000x6000
GPU处理：~0.8秒
CPU理：~15秒
```


#### CPU处理器（备用）
**技术实现**：
- 纯Kotlin实现，无需外部依赖
- 三线性插值算法，确保色彩过渡平滑
- 多线程并行处理，充分利用CPU核心
- 内存优化，避免大图OOM

### 水印系统

#### **EXIF变量支持**：

| 变量名 | 参数 | 备注 | 示例 |
| :---: | :---: | :---: | :---: |
| `{ISO}` | ISO感光度 |  | 100 |
| `{APERTURE}` | 光圈 |  | 2.8 |
| `{SHUTTER}` | 快门 | 支持分数格式 | 1/125 |
| `{CAMERA_MODEL}` | 相机型号 |  | DC-S1 |
| `{LENS_MODEL}` | 镜头型号 |  | 24-70mm f/2.8 |
| `{DATE}` | 拍摄日期 |  | 2025-01-15 |
| `{TIME}` | 拍摄时间 |  | 14:30:25 |
| `{FOCAL_LENGTH}` | 镜头焦距 |  | 35mm |
| `{EXPOSURE_COMPENSATION}` | 曝光补偿 |  | +0.7 EV |
| `{WHITE_BALANCE}` | 白平衡 |  | 自动 |
| `{FLASH}` | 闪光灯 | 是/否 | 否 |
| `{LUT1}` | LUT1文件名 | 无.cube后缀 |  |
| `{LUT2}` | LUT2文件名 | 无.cube后缀 |  |
| `{LUT1_STRENGTH}` | LUT1强度 | 百分比 | 66% |
| `{LUT2_STRENGTH}` | LUT2强度 | 百分比 | 66% |


**高级排版特性**：
- **多行文本**：支持换行
- **对齐方式**：左对齐/居中/右对齐
- **自定义字体**：支持导入TTF/OTF字体文件
- **智能尺寸调节**：根据图片宽度自动调节字体大小
- **精细间距控制**：字间距、行间距可调

#### 图片水印功能
- **支持格式**：PNG（透明）、JPG、WEBP
- **尺寸控制**：基于图片宽度的百分比调节
- **透明度**：0-100%可调，支持半透明叠加

#### 边框功能
- **四边独立控制**：上下左右边框宽度独立设置
- **智能比例**：基于图片短边的百分比计算
- **颜色定制**：支持任意颜色

### 批量处理与文件夹监控

#### 批量处理特性
- **多图片同时选择**：支持从相册一次性选择多张图片
- **进度显示**：实时显示处理进度和剩余时间
- **并行处理**：CPU模式下支持最大5个图片同时处理
- **错误处理**：单个图片失败不影响整体进度

#### 文件夹监控机制
**工作原理**：
1. **实时扫描**：每2秒扫描一次输入文件夹
2. **文件过滤**：仅处理JPG/JPEG/PNG/WEBP格式
3. **完整性校验**：检测文件是否上传完成
4. **去重处理**：防止同一文件被多次处理
5. **断点续传**：应用重启后自动继续未完成任务

**错误恢复**：
- **重试机制**：不完整文件最多重试10次
- **内存管理**：自动释放无用内存，防止内存泄漏
- **电源管理**：获取WakeLock，防止系统休眠中断处理

## ⚙️ 设置详解

### 处理器设置

#### 处理器类型选择
| 选项 | 描述 | 适用场景 | 性能表现 |
| :---: | :---: | :---: | :---: |
| **AUTO**（推荐） | 自动选择最优处理器 | 适合新手用户 | GPU可用时优先使用GPU |
| **GPU** | 强制使用GPU处理 | 高性能需求 | 最快，但部分设备不支持 |
| **CPU** | 强制使用CPU处理 | 兼容性优先 | 较慢，但兼容性最好 |

#### GPU可用性检测
应用会自动检测设备的GPU能力：
- **OpenGL ES 3.0支持**检测
- **3D纹理支持**验证
- **着色器编译**测试
- **内存容量**评估


### 处理参数

#### 效果强度（Strength）
- **范围**：0-100%
- **默认值**：60%
- **作用**：控制LUT效果与原图的混合比例

#### 输出质量（Quality）
- **范围**：50-100%
- **默认值**：90%
- **影响**：输出文件大小和画质

#### 抖动算法（Dithering）
| 算法 | 描述 | 适用场景 | 计算复杂度 |
| :---: | :---: | :---: | :---: |
| **无抖动** | 不使用抖动算法 | 大图片，追求速度 | 最低 |
| **Floyd-Steinberg** | 经典错误扩散算法 | 追求高质量过渡 | 高 |
| **随机抖动** | 基于随机噪声的抖动 | 平衡处理速度与质量 | 低 |

> ⚠️ **注意**：抖动算法主要用于减少色彩断层，对于高质量原图可能效果不明显，触发分块算法会强制应用随机抖动。

### 水印配置

#### 基础设置
| 项目 | 说明 | 范围/选项 | 默认值 |
| :---: | :---: | :---: | :---: |
| **水印开关** | 启用/禁用水印功能 | 开/关 | 关 |
| **文字水印** | 启用文字水印 | 开/关 | 开 |
| **图片水印** | 启用图片水印 | 开/关 | 关 |

> 📝 **重要**：文字水印和图片水印可以同时使用，位置和透明度独立控制。

#### 文字水印设置
| 参数 | 说明 | 范围 | 默认值 |
| :---: | :---: | :---: | :---: |
| **文字内容** | 水印文本，支持EXIF变量 | 任意文本 | 拍摄参数：ISO {ISO}... |
| **水平位置** | 水平位置百分比 | 0-100% | 10% |
| **垂直位置** | 垂直位置百分比 | 0-100% | 90% |
| **文字大小** | 相对于图片宽度的百分比 | 5-50% | 10% |
| **透明度** | 文字透明度 | 0-100% | 80% |
| **文字颜色** | 文字颜色（十六进制） | #000000-#FFFFFF | #FFFFFF |
| **对齐方式** | 文字对齐方式 | 左/中/右 | 左对齐 |

#### 高级文字设置
| 参数 | 说明 | 范围 | 默认值 |
| :---: | :---: | :---: | :---: |
| **字体文件** | 自定义字体TTF/OTF文件 | 文件路径 | 系统默认 |
| **字间距** | 字符间隔百分比 | 0-100% | 0% |
| **行间距** | 行与行之间的间距百分比 | 0-100% | 0% |

#### 图片水印设置
| 参数 | 说明 | 范围 | 默认值 |
| :---: | :---: | :---: | :---: |
| **水印图片** | 水印图片文件路径 | PNG/JPG/WEBP | 无 |
| **水平位置** | 水平位置百分比 | 0-100% | 90% |
| **垂直位置** | 垂直位置百分比 | 0-100% | 10% |
| **图片大小** | 相对于图片宽度的百分比 | 5-50% | 10% |
| **透明度** | 图片透明度 | 0-100% | 80% |

#### 边框设置
| 参数 | 说明 | 范围 | 默认值 |
| :---: | :---: | :---: | :---: |
| **上边框** | 上边框宽度百分比 | 0-150% | 0% |
| **下边框** | 下边框宽度百分比 | 0-150% | 0% |
| **左边框** | 左边框宽度百分比 | 0-150% | 0% |
| **右边框** | 右边框宽度百分比 | 0-150% | 0% |
| **边框颜色** | 边框颜色（十六进制） | #000000-#FFFFFF | #000000 |

> 📊 **计算方式**：边框宽度基于图片短边计算，确保不同尺寸图片的边框比例一致。

### 文件夹监控设置

#### 基本配置
| 项目 | 说明 | 注意事项 |
| :---: | :---: | :---: |
| **输入文件夹** | 监控的源文件夹 | 需要读取权限 |
| **输出文件夹** | 处理后的图片保存位置 | 需要写入权限 |
| **LUT文件** | 使用的LUT文件 | 仅支持.cube格式 |
| **监控开关** | 启用/停止文件夹监控 | 开启后后台运行 |

#### 高级选项
- **处理参数**：与批量处理不同的强度、质量、抖动设置
- **水印配置**：与批量处理相同的水印参数
- **文件命名**：自动按照`原文件名-LUT名.jpg`格式命名

#### 后台运行保障
为了确保文件夹监控服务稳定运行，应用实现了多重保障机制：

1. **前台服务**：使用Foreground Service确保高优先级
2. **WakeLock**：防止系统休眠中断处理
3. **开机启动**：支持开机自动恢复监控
4. **崩溃恢复**：应用崩溃后自动重启监控
5. **通知提醒**：实时显示监控状态和处理进度



## 🎨 使用场景

### 专业摄影应用

#### 相机制造商支持

- **松下**：使用LUMIX Sync边拍边传以及机内lut监看搭配本应用
- **索尼**：配合Imaging Edge Mobile实现实时LUT处理
- **佳能/尼康**：通过相应应用传输后自动处理
- **其他** ：可监控文件夹然后直接从读卡器等设备复制快速应用


## 📡 技术支持

### 技术栈
- **开发语言**：Kotlin
- **框架**：Android Jetpack，Material Design 3
- **架构**：MVVM + Repository Pattern
- **图形处理**：OpenGL ES 3.0，Canvas API
- **并发处理**：Kotlin Coroutines
- **数据存储**：SharedPreferences，DocumentFile API

### 开源信息
本应用基于Python版本LUT处理算法移植开发：
- **Python版项目**：[Lut2Photo-Py](https://github.com/qh7574/Lut2Photo-Py)
- **授权协议**：免费使用，遵循MPL协议

### 贡献与反馈

- **Bug报告**：通过GitHub Issues
- **功能建议**：欢迎在GitHub上提出Feature Request

------------

### 其他

本App免费使用，如果有帮到你，可以在设置页找到赞助码🍵

**作者**：偷光你的小鱼干（某些情况下也叫狸花饺子喵）

> 💻 *代码水平很烂，感谢AI，能跑就行*

---

🌟 **喜欢这个项目吗？记得给个 Star ⭐**
